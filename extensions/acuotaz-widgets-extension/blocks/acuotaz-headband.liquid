{% schema %}
{
  "name": "aCuotaz Headband",
  "target": "section",
  "settings": [
    {
      "type": "header",
      "content": "Configuración del API"
    },
    {
      "type": "text",
      "id": "client_id",
      "label": "Client ID",
      "info": "Token de autorización para el API"
    },
  ]
}
{% endschema %}

{% comment %}
  aCuotaz Headband
{% endcomment %}

{% assign client_id = block.settings.client_id %}
{% assign api_url = 'https://apurata.com/pos/acuotaz-head-band' %}

{% comment %} Solo renderizar el headband si hay un client_id configurado {% endcomment %}
{% if client_id and client_id != blank %}
<div class="acuotaz-headband-container acuotaz-header-banner" id="acuotaz-headband-{{ block.id }}">
  <div class="acuotaz-loading" style="text-align: center; padding: 10px;">
    <img src="{{ 'thumbs-up.png' | asset_url }}" alt="aCuotaz" width="20" height="20" style="width: 20px; height: 20px; margin-right: 8px; vertical-align: middle;">
    Cargando ofertas de aCuotaz...
  </div>
</div>
{% endif %}

<style>
.acuotaz-header-banner {
  position: absolute; /* fixed para sticky */
  top: 0;
  left: 0;
  right: 0;
  z-index: 9999;
  background-color: #f8f8f8;
  border-bottom: 1px solid #e0e0e0;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  width: 100%;
}
body {
  padding-top: 50px !important;
}
</style>

{% if client_id and client_id != blank %}
<script>
(function() {
  const container = document.getElementById('acuotaz-headband-{{ block.id }}');
  if (!container) return;

  fetch('{{ api_url }}', {
    method: 'GET',
    headers: {
      'Authorization': 'Bearer {{ client_id }}',
      'Client_id': '{{ client_id }}'
    }
  })
  .then(response => {
    if (!response.ok) {
      throw new Error('Error en la respuesta del API: ' + response.status);
    }
    return response.text();
  })
  .then(html => {
    container.innerHTML = html;
  })
  .catch(error => {
    console.error('Error cargando el banner de aCuotaz:', error);
    container.innerHTML = '<div style="padding: 10px; text-align: center; color: #666; font-size: 14px;">No se pudieron cargar las ofertas en este momento.</div>';
  });
})();
</script>
{% endif %}